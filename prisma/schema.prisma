generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  author
  reader
}

enum ArticleStatus {
  Draft
  Published
}

model User {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())

  articles  Article[]
  readLogs  ReadLog[] @relation("ReaderReadLogs")
}

model Article {
  id        String        @id @default(uuid()) @db.Uuid
  title     String
  content   String
  category  String
  status    ArticleStatus @default(Draft)
  authorId  String        @map("author_id") @db.Uuid
  createdAt DateTime      @default(now())
  deletedAt DateTime?     @map("deleted_at")

  author         User            @relation(fields: [authorId], references: [id], onDelete: Restrict)
  readLogs       ReadLog[]
  dailyAnalytics DailyAnalytics[]

  @@map("articles")
}

model ReadLog {
  id        String   @id @default(uuid()) @db.Uuid
  articleId String   @map("article_id") @db.Uuid
  readerId  String?  @map("reader_id") @db.Uuid
  readAt    DateTime @default(now()) @map("read_at")

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  reader  User?   @relation("ReaderReadLogs", fields: [readerId], references: [id], onDelete: SetNull)

  @@index([articleId, readAt])
  @@map("read_logs")
}

model DailyAnalytics {
  id        String   @id @default(uuid()) @db.Uuid
  articleId String   @map("article_id") @db.Uuid
  viewCount Int      @map("view_count")
  date      DateTime @db.Date

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, date])
  @@map("daily_analytics")
}
